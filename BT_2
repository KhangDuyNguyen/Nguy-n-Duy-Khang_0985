using System;
using System.Collections.Generic;
using System.Linq;

namespace Lab01_02
{
    class Student
    {
        // ===== 1. Fields =====
        private string studentID;
        private string fullName;
        private float averageScore;
        private string faculty;

        // ===== 2. Properties =====
        public string StudentID { get => studentID; set => studentID = value; }
        public string FullName { get => fullName; set => fullName = value; }
        public float AverageScore { get => averageScore; set => averageScore = value; }
        public string Faculty { get => faculty; set => faculty = value; }

        // ===== 3. Constructors =====
        public Student() { }

        public Student(string studentID, string fullName, float averageScore, string faculty)
        {
            this.studentID = studentID;
            this.fullName = fullName;
            this.averageScore = averageScore;
            this.faculty = faculty;
        }

        // ===== 4. Methods =====
        public void Input()
        {
            Console.Write("Nhap MSSV: ");
            StudentID = Console.ReadLine();

            Console.Write("Nhap Ho ten: ");
            FullName = Console.ReadLine();

            Console.Write("Nhap Diem TB: ");
            AverageScore = float.Parse(Console.ReadLine());

            Console.Write("Nhap Khoa: ");
            Faculty = Console.ReadLine();
        }

        public void Show()
        {
            Console.WriteLine("MSSV: {0} | Ho Ten: {1} | Khoa: {2} | Diem TB: {3}",
                StudentID, FullName, Faculty, AverageScore);
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            List<Student> studentList = new List<Student>();
            bool exit = false;

            while (!exit)
            {
                Console.WriteLine("\n===== MENU =====");
                Console.WriteLine("1. Them sinh vien");
                Console.WriteLine("2. Hien thi danh sach sinh vien");
                Console.WriteLine("3. Sinh vien thuoc khoa CNTT");
                Console.WriteLine("4. Sinh vien co diem TB >= 5");
                Console.WriteLine("5. Sap xep theo diem TB tang dan");
                Console.WriteLine("6. Sinh vien co diem TB >= 5 va khoa CNTT");
                Console.WriteLine("7. Sinh vien co diem TB cao nhat khoa CNTT");
                Console.WriteLine("8. Thong ke so luong xep loai");
                Console.WriteLine("0. Thoat");
                Console.Write("Chon chuc nang: ");

                string choice = Console.ReadLine();

                switch (choice)
                {
                    case "1":
                        AddStudent(studentList);
                        break;

                    case "2":
                        DisplayStudentList(studentList);
                        break;

                    case "3":
                        DisplayStudentsByFaculty(studentList, "CNTT");
                        break;

                    case "4":
                        DisplayStudentsWithHighAverageScore(studentList, 5);
                        break;

                    case "5":
                        SortStudentsByAverageScore(studentList);
                        break;

                    case "6":
                        DisplayStudentsByFacultyAndScore(studentList, "CNTT", 5);
                        break;

                    case "7":
                        DisplayStudentsWithHighestAverageScoreByFaculty(studentList, "CNTT");
                        break;

                    case "8":
                        CountStudentRanks(studentList);
                        break;

                    case "0":
                        Console.WriteLine("Ket thuc chuong trinh.");
                        exit = true;
                        break;

                    default:
                        Console.WriteLine("Lua chon khong hop le!");
                        break;
                }
            }
        }

        // ===== CASE 1 =====
        static void AddStudent(List<Student> studentList)
        {
            Console.WriteLine("\n=== Nhap thong tin sinh vien ===");
            Student student = new Student();
            student.Input();
            studentList.Add(student);
            Console.WriteLine("Them sinh vien thanh cong!");
        }

        // ===== CASE 2 =====
        static void DisplayStudentList(List<Student> studentList)
        {
            Console.WriteLine("\n=== Danh sach sinh vien ===");
            foreach (Student student in studentList)
            {
                student.Show();
            }
        }

        // ===== CASE 3 =====
        static void DisplayStudentsByFaculty(List<Student> studentList, string faculty)
        {
            Console.WriteLine("\n=== Sinh vien thuoc khoa {0} ===", faculty);

            var students = studentList
                .Where(s => s.Faculty.Equals(faculty, StringComparison.OrdinalIgnoreCase))
                .ToList();

            DisplayStudentList(students);
        }

        // ===== CASE 4 =====
        static void DisplayStudentsWithHighAverageScore(List<Student> studentList, float minDTB)
        {
            Console.WriteLine("\n=== Sinh vien co diem TB >= {0} ===", minDTB);

            var students = studentList
                .Where(s => s.AverageScore >= minDTB)
                .ToList();

            DisplayStudentList(students);
        }

        // ===== CASE 5 =====
        static void SortStudentsByAverageScore(List<Student> studentList)
        {
            Console.WriteLine("\n=== Sap xep theo diem TB tang dan ===");

            var sortedStudents = studentList
                .OrderBy(s => s.AverageScore)
                .ToList();

            DisplayStudentList(sortedStudents);
        }

        // ===== CASE 6 =====
        static void DisplayStudentsByFacultyAndScore(List<Student> studentList, string faculty, float minDTB)
        {
            Console.WriteLine("\n=== Sinh vien DTB >= {0} & Khoa {1} ===", minDTB, faculty);

            var students = studentList
                .Where(s => s.AverageScore >= minDTB &&
                            s.Faculty.Equals(faculty, StringComparison.OrdinalIgnoreCase))
                .ToList();

            DisplayStudentList(students);
        }

        // ===== CASE 7 =====
        static void DisplayStudentsWithHighestAverageScoreByFaculty(List<Student> studentList, string faculty)
        {
            Console.WriteLine("\n=== Sinh vien diem TB cao nhat khoa {0} ===", faculty);

            var inFaculty = studentList
                .Where(s => s.Faculty.Equals(faculty, StringComparison.OrdinalIgnoreCase));

            if (!inFaculty.Any())
            {
                Console.WriteLine("Khong co sinh vien thuoc khoa nay.");
                return;
            }

            float maxScore = inFaculty.Max(s => s.AverageScore);

            var topStudents = inFaculty
                .Where(s => s.AverageScore == maxScore)
                .ToList();

            DisplayStudentList(topStudents);
        }

        // ===== CASE 8 =====
        static string GetRank(float score)
        {
            if (score >= 9) return "Xuat sac";
            else if (score >= 8) return "Gioi";
            else if (score >= 7) return "Kha";
            else if (score >= 5) return "Trung binh";
            else if (score >= 4) return "Yeu";
            else return "Kem";
        }

        static void CountStudentRanks(List<Student> studentList)
        {
            Console.WriteLine("\n=== Thong ke xep loai sinh vien ===");

            var rankGroups = studentList
                .GroupBy(s => GetRank(s.AverageScore))
                .Select(g => new { Rank = g.Key, Count = g.Count() });

            foreach (var rank in rankGroups)
            {
                Console.WriteLine("{0}: {1} sinh vien", rank.Rank, rank.Count);
            }
        }
    }
}
